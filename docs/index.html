<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Simulador de Riesgo de Sequ√≠a | Panel</title>
  <meta name="description" content="Panel profesional para simular riesgo de sequ√≠a en embalses: escenarios clim√°ticos, horizonte, an√°lisis de riesgo y predicci√≥n mensual." />
  <link rel="stylesheet" href="assets/styles.css" />
</head>
<body>
  <a class="skip-link" href="#main">Saltar al contenido</a>

  <div class="app-shell">
    <header class="topbar">
      <div class="brand">
        <div class="brand-mark" aria-hidden="true">üåä</div> 
        <div class="brand-text">
          <div class="brand-title">Simulador de Riesgo de Sequ√≠a</div>
          <div class="brand-subtitle">Panel de simulaci√≥n y predicci√≥n mensual</div>
        </div>
      </div>

      <div class="topbar-actions">
        <div class="status-pill" id="apiStatusPill" title="Estado del backend">
          <span class="status-dot" id="apiStatusDot" aria-hidden="true"></span>
          <span class="status-text" id="apiStatusText">API: comprobando‚Ä¶</span>
        </div>
        <button class="ghost-btn" type="button" id="copyBackendUrl" title="Copiar URL del backend">
          Copiar URL
        </button>
      </div>
    </header>

    <nav class="tabs" role="tablist" aria-label="Navegaci√≥n">
      <button class="tab active" role="tab" aria-selected="true" aria-controls="tab-simulacion" id="tabBtn-simulacion" data-tab="simulacion" type="button">Simulaci√≥n</button>
      <button class="tab" role="tab" aria-selected="false" aria-controls="tab-dashboard" id="tabBtn-dashboard" data-tab="dashboard" type="button">Dashboard</button>
      <button class="tab" role="tab" aria-selected="false" aria-controls="tab-metodologia" id="tabBtn-metodologia" data-tab="metodologia" type="button">Metodolog√≠a</button>
      <button class="tab" role="tab" aria-selected="false" aria-controls="tab-ayuda" id="tabBtn-ayuda" data-tab="ayuda" type="button">Ayuda</button>
      
      <button class="tab btn-enlace-datos" role="link" type="button" onclick="window.location.href='index_Datos.html'">
        Acceder a Visualizaci√≥n de Datos
      </button>
</nav>

    <main id="main" class="content">
      <!-- TAB: SIMULACI√ìN -->
      <section class="tab-panel active" id="tab-simulacion" role="tabpanel" aria-labelledby="tabBtn-simulacion">
        <div class="grid-2">
          <section class="card">
            <header class="card-header">
              <h1 class="card-title">Simulaci√≥n</h1>
              <p class="card-subtitle">Selecciona par√°metros, dispara el endpoint y obt√©n un informe de riesgo con predicci√≥n mensual.</p>
            </header>

            <div class="card-body">
              <form id="predictionForm" class="form">
                <div class="form-group">
                  <label for="horizonte">Horizonte de predicci√≥n (meses)</label>
                  <select id="horizonte">
                    <option value="">Selecciona una opci√≥n</option>
                    <option value="3">3 meses</option>
                    <option value="6">6 meses</option>
                    <option value="12">12 meses</option>
                    <option value="24">24 meses</option>
                  </select>
                  <p class="hint">Modo A: define el horizonte manualmente.</p>
                </div>

                <div class="form-group">
                  <label for="fechaObjetivo">Fecha objetivo (opcional)</label>
                  <input type="month" id="fechaObjetivo" placeholder="Selecciona una fecha" />
                  <p class="hint">Modo B: calcula meses autom√°ticamente desde el √∫ltimo dato (marzo 2021).</p>
                </div>

                <div class="form-group">
                  <label for="escenario">Escenario clim√°tico</label>
                  <select id="escenario" required>
                    <option value="">Selecciona una opci√≥n</option>
                    <option value="normal">Normal</option>
                    <option value="seco">Seco</option>
                    <option value="muy_seco">Muy seco</option>
                    <option value="humedo">H√∫medo</option>
                  </select>
                  <p class="hint">Define el ‚Äúmood‚Äù del clima. Ojal√° siempre ‚ÄúH√∫medo‚Äù, pero ya sabemos‚Ä¶</p>
                </div>

                <div class="form-group">
                  <label for="nivelUsuario">Nivel actual del embalse (hm¬≥) (opcional)</label>
                  <input type="number" id="nivelUsuario" step="0.1" placeholder="Nivel actual estimado (hm¬≥)" />
                  <p class="hint">Si lo informas, el an√°lisis ajusta el riesgo al punto de partida.</p>
                </div>

                <div class="form-actions">
                  <button type="submit" id="calcularBtn" class="primary-btn">Calcular riesgo</button>
                  <button type="button" id="resetBtn" class="secondary-btn">Limpiar</button>
                </div>
              </form>

              <div class="inline-meta">
                <div><span class="meta-key">Backend:</span> <span class="meta-value" id="backendUrlDisplay">-</span></div>
                <div><span class="meta-key">√öltimo dato:</span> <span class="meta-value" id="lastDataDisplay">-</span></div>
              </div>
            </div>
          </section>

          <section class="card">
            <header class="card-header">
              <h2 class="card-title">Resultados</h2>
              <p class="card-subtitle">Salidas del modelo y se√±ales de riesgo a nivel ejecutivo (pero sin humo).</p>
            </header>

            <div class="card-body">
              <div class="error-message" id="errorMessage" role="alert" aria-live="polite"></div>

              <div class="results-section" id="resultsSection">
                <div class="kpi-row">
                  <div class="kpi" id="riesgoBox">
                    <div class="kpi-label">Riesgo global</div>
                    <div class="kpi-value" id="riesgoGlobal">-</div>
                  </div>
                  <div class="kpi info">
                    <div class="kpi-label">Se√±al</div>
                    <div class="kpi-value" id="sequiaInfo">-</div>
                  </div>
                </div>

                <div class="table-container">
                  <table id="prediccionTable">
                    <thead>
                      <tr>
                        <th>Fecha</th>
                        <th>Nivel (hm¬≥)</th>
                        <th>Situaci√≥n</th>
                        <th>¬øSequ√≠a?</th>
                        <th>¬øNivel bajo?</th>
                      </tr>
                    </thead>
                    <tbody id="prediccionTbody"></tbody>
                  </table>
                </div>
              </div>

              <div class="empty-state" id="emptyState">
                <div class="empty-emoji" aria-hidden="true">üìà</div>
                <div class="empty-title">A√∫n no hay predicci√≥n</div>
                <div class="empty-text">Rellena el formulario y ejecuta una simulaci√≥n. Tus KPIs est√°n esperando su momento.</div>
              </div>
            </div>
          </section>
        </div>
      </section>

      <!-- TAB: DASHBOARD -->
      <section class="tab-panel" id="tab-dashboard" role="tabpanel" aria-labelledby="tabBtn-dashboard">
        <section class="card">
          <header class="card-header">
            <h1 class="card-title">Dashboard</h1>
            <p class="card-subtitle">Visi√≥n r√°pida: √∫ltimo run, par√°metros y estado del servicio.</p>
          </header>
          <div class="card-body">
            <div class="grid-3">
              <div class="mini-card">
                <div class="mini-k">√öltima ejecuci√≥n</div>
                <div class="mini-v" id="dashLastRun">-</div>
                <div class="mini-h">Se actualiza al completar una predicci√≥n.</div>
              </div>
              <div class="mini-card">
                <div class="mini-k">Riesgo (√∫ltimo)</div>
                <div class="mini-v" id="dashLastRisk">-</div>
                <div class="mini-h">Alineado con ‚ÄúRiesgo global‚Äù.</div>
              </div>
              <div class="mini-card">
                <div class="mini-k">Horizonte (√∫ltimo)</div>
                <div class="mini-v" id="dashLastHorizon">-</div>
                <div class="mini-h">En meses.</div>
              </div>
            </div>

            <div class="divider"></div>

            <div class="grid-2">
              <div class="callout">
                <h3>Checklist operativo</h3>
                <ul>
                  <li>Si el estado de API est√° en rojo, revisa la URL del backend.</li>
                  <li>Si la API responde pero el endpoint falla, revisa logs del servicio y CORS.</li>
                  <li>Si los resultados son raros, valida el escenario y el horizonte (cl√°sico).</li>
                </ul>
              </div>
              <div class="callout">
                <h3>Configuraci√≥n</h3>
                <div class="kv">
                  <div class="kv-row"><span class="kv-k">BACKEND_URL</span><span class="kv-v" id="dashBackend">-</span></div>
                  <div class="kv-row"><span class="kv-k">LAST_DATA_DATE</span><span class="kv-v" id="dashLastData">-</span></div>
                </div>
              </div>
            </div>
          </div>
        </section>
      </section>

      <!-- TAB: METODOLOG√çA -->
      <section class="tab-panel" id="tab-metodologia" role="tabpanel" aria-labelledby="tabBtn-metodologia">
        <section class="card">
          <header class="card-header">
            <h1 class="card-title">Metodolog√≠a</h1>
            <p class="card-subtitle">Qu√© hace el modelo, qu√© significa ‚Äúriesgo‚Äù y c√≥mo leer la tabla.</p>
          </header>
          <div class="card-body prose">
            <h2>C√≥mo funciona (versi√≥n ejecutiva)</h2>
            <p>
              El backend genera una predicci√≥n mensual del nivel del embalse para el horizonte elegido. Con esa proyecci√≥n, clasifica
              cada mes (normal / nivel bajo / sequ√≠a) y sintetiza un <strong>riesgo global</strong>.
            </p>

            <h2>Interpretaci√≥n r√°pida</h2>
            <ul>
              <li><strong>Riesgo bajo</strong>: la proyecci√≥n se mantiene en niveles saludables.</li>
              <li><strong>Riesgo moderado</strong>: hay meses con estr√©s (nivel bajo) pero sin se√±al fuerte de sequ√≠a.</li>
              <li><strong>Riesgo alto / cr√≠tico</strong>: aparece sequ√≠a probable y/o niveles persistentemente bajos.</li>
            </ul>

            <h2>Notas operativas</h2>
            <p>
              Este panel est√° dise√±ado para ‚Äútime-to-insight‚Äù y no para sustituir un informe hidrol√≥gico completo. √ösalo para
              comparar escenarios y priorizar acciones.
            </p>
          </div>
        </section>
      </section>

      <!-- TAB: AYUDA -->
      <section class="tab-panel" id="tab-ayuda" role="tabpanel" aria-labelledby="tabBtn-ayuda">
        <section class="card">
          <header class="card-header">
            <h1 class="card-title">Ayuda</h1>
            <p class="card-subtitle">FAQ r√°pida para que el ‚Äúgo live‚Äù no se convierta en ‚Äúgo cry‚Äù.</p>
          </header>
          <div class="card-body prose">
            <h2>¬øNecesito crear m√°s archivos HTML?</h2>
            <p>
              No. Esta versi√≥n usa <strong>una sola p√°gina</strong> con pesta√±as (tabs) manejadas por JavaScript. Si m√°s adelante quieres
              SEO avanzado o rutas reales, ah√≠ s√≠ tendr√≠a sentido separar en varias p√°ginas.
            </p>

            <h2>¬øQu√© endpoint llama el formulario?</h2>
            <p>
              Hace un <code>POST</code> a <code>/predict</code> en la URL del backend configurada en <code>assets/script.js</code>.
            </p>

            <h2>Errores t√≠picos</h2>
            <ul>
              <li><strong>CORS</strong>: el backend debe permitir el origen (dominio) del frontend.</li>
              <li><strong>Backend ca√≠do</strong>: revisa el estado en la esquina superior derecha.</li>
              <li><strong>Fecha objetivo</strong>: debe ser posterior a marzo 2021.</li>
            </ul>
          </div>
        </section>
      </section>
    </main>

    <footer class="footer">
      <div class="footer-left">¬© <span id="yearNow"></span> Panel de simulaci√≥n</div>
      <div class="footer-right">Hecho para operar con foco: menos drama, m√°s predicci√≥n.</div>
    </footer>
  </div>

  <script src="assets/script.js"></script>
</body>
</html>
